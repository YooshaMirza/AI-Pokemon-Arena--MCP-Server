<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Pokemon AI Battle Arena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 69, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #16213e 75%, #1a1a2e 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            z-index: -1;
            pointer-events: none;
        }

        .battle-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .battle-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .battle-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .pokemon-selection {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .pokemon-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin: 10px;
        }

        .pokemon-card h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #ffd700;
        }

        .pokemon-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .select-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .pokemon-display {
            margin: 15px 0;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .health-bar-container {
            width: 100%;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 2px;
            position: relative;
        }

        .health-bar {
            height: 8px;
            background: linear-gradient(90deg, #ff4757, #ff3838);
            border-radius: 8px;
            transition: width 0.3s ease-out;
            position: relative;
        }

        .health-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 8px;
            animation: healthGlow 2s ease-in-out infinite;
        }

        @keyframes healthGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .health-text {
            font-size: 0.8rem;
            color: #fff;
            margin-top: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .pokemon-name {
            color: #ffd700;
            margin: 10px 0;
            font-size: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .pokemon-stats {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 20px;
        }

        .battle-controls {
            text-align: center;
            margin: 30px 0;
        }

        .battle-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff4757, #ff3838);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
        }

        .battle-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.6);
        }

        .battle-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .battle-log {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .battle-log h3 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .log-content {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border-left: 3px solid #ffd700;
        }

        .battle-result {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 71, 87, 0.2));
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .winner-announcement {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            border: 2px solid #ffd700;
        }

        .scenario-description, .key-factors {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            text-align: center;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(231, 76, 60, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 2px solid #e74c3c;
            text-align: center;
        }

        .success-message {
            background: rgba(46, 204, 113, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 2px solid #2ecc71;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="battle-container">
        <header class="battle-header">
            <h1>🎮 POKEMON AI BATTLE ARENA 🎮</h1>
            <p>Choose your Pokemon warriors and witness the epic battle!</p>
        </header>

        <div class="pokemon-selection">
            <div class="pokemon-card" id="pokemon1-card">
                <h3>Player 1</h3>
                <input type="text" id="pokemon1-input" placeholder="Enter Pokemon name..." class="pokemon-input">
                <button onclick="selectPokemon(1)" class="select-btn">🔍 Select</button>
                <div class="pokemon-display" id="pokemon1-display">
                    <span>Choose your Pokemon!</span>
                </div>
                <div class="pokemon-stats" id="pokemon1-stats"></div>
            </div>

            <div class="vs-divider">
                <span>VS</span>
            </div>

            <div class="pokemon-card" id="pokemon2-card">
                <h3>Player 2</h3>
                <input type="text" id="pokemon2-input" placeholder="Enter Pokemon name..." class="pokemon-input">
                <button onclick="selectPokemon(2)" class="select-btn">🔍 Select</button>
                <div class="pokemon-display" id="pokemon2-display">
                    <span>Choose your Pokemon!</span>
                </div>
                <div class="pokemon-stats" id="pokemon2-stats"></div>
            </div>
        </div>

        <div class="battle-controls">
            <button onclick="startBattle()" class="battle-btn" id="battle-btn" disabled>
                ⚔️ START BATTLE ⚔️
            </button>
        </div>

        <div class="battle-log" id="battle-log">
            <h3>📜 Battle Log</h3>
            <div class="log-content" id="log-content">
                <p>Battle log will appear here...</p>
            </div>
        </div>

        <div class="battle-result" id="battle-result" style="display: none;">
            <div class="winner-announcement" id="winner-announcement"></div>
            <div class="scenario-description" id="scenario-description"></div>
            <div class="key-factors" id="key-factors"></div>
        </div>

        <div class="loading-overlay" id="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p id="loading-text">🤖 AI Analyzing Battle...</p>
            </div>
        </div>
    </div>

    <script>
        let selectedPokemon1 = null;
        let selectedPokemon2 = null;
        let pokemon1HP = 0;
        let pokemon2HP = 0;

        async function selectPokemon(playerNumber) {
            const input = document.getElementById(`pokemon${playerNumber}-input`);
            const pokemonName = input.value.trim().toLowerCase();

            if (!pokemonName) {
                showMessage('Please enter a Pokemon name!', 'error', `pokemon${playerNumber}-card`);
                return;
            }

            const selectBtn = input.nextElementSibling;
            const originalText = selectBtn.textContent;
            selectBtn.textContent = '🔍 Searching...';
            selectBtn.disabled = true;

            try {
                console.log(`Fetching Pokemon: ${pokemonName}`);
                
                // Direct API call to test
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonName}`);
                
                if (!response.ok) {
                    throw new Error(`Pokemon "${pokemonName}" not found! Please check the spelling.`);
                }

                const pokemonData = await response.json();
                console.log('Pokemon data received:', pokemonData);

                // Transform data
                const transformedData = {
                    id: pokemonData.id,
                    name: pokemonData.name,
                    sprites: pokemonData.sprites,
                    types: pokemonData.types.map(type => type.type.name),
                    stats: {
                        hp: pokemonData.stats.find(stat => stat.stat.name === 'hp').base_stat,
                        attack: pokemonData.stats.find(stat => stat.stat.name === 'attack').base_stat,
                        defense: pokemonData.stats.find(stat => stat.stat.name === 'defense').base_stat,
                        specialAttack: pokemonData.stats.find(stat => stat.stat.name === 'special-attack').base_stat,
                        specialDefense: pokemonData.stats.find(stat => stat.stat.name === 'special-defense').base_stat,
                        speed: pokemonData.stats.find(stat => stat.stat.name === 'speed').base_stat
                    }
                };

                updatePokemonDisplay(playerNumber, transformedData);

                if (playerNumber === 1) {
                    selectedPokemon1 = transformedData;
                    pokemon1HP = transformedData.stats.hp;
                } else {
                    selectedPokemon2 = transformedData;
                    pokemon2HP = transformedData.stats.hp;
                }

                checkBattleReady();
                showMessage(`✅ ${transformedData.name.charAt(0).toUpperCase() + transformedData.name.slice(1)} selected!`, 'success', `pokemon${playerNumber}-card`);

            } catch (error) {
                console.error('Error fetching Pokemon:', error);
                showMessage(`❌ ${error.message}`, 'error', `pokemon${playerNumber}-card`);
            } finally {
                selectBtn.textContent = originalText;
                selectBtn.disabled = false;
            }
        }

        function updatePokemonDisplay(playerNumber, pokemonData) {
            const displayDiv = document.getElementById(`pokemon${playerNumber}-display`);
            const statsDiv = document.getElementById(`pokemon${playerNumber}-stats`);

            const spriteUrl = pokemonData.sprites.other?.['official-artwork']?.front_default ||
                             pokemonData.sprites.front_default ||
                             `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemonData.id}.png`;

            displayDiv.innerHTML = `
                <img src="${spriteUrl}" alt="${pokemonData.name}" class="pokemon-sprite">
                <div class="pokemon-name">${pokemonData.name.charAt(0).toUpperCase() + pokemonData.name.slice(1)}</div>
                <div class="health-bar-container">
                    <div class="health-bar" id="health-bar-${playerNumber}" style="width: 100%;"></div>
                </div>
                <div class="health-text" id="health-text-${playerNumber}">HP: ${pokemonData.stats.hp}/${pokemonData.stats.hp}</div>
                <div>Types: ${pokemonData.types.join(', ')}</div>
            `;

            const totalStats = Object.values(pokemonData.stats).reduce((a, b) => a + b, 0);
            statsDiv.innerHTML = `
                <strong>Stats:</strong><br>
                HP: ${pokemonData.stats.hp} | ATK: ${pokemonData.stats.attack} | DEF: ${pokemonData.stats.defense}<br>
                SPA: ${pokemonData.stats.specialAttack} | SPD: ${pokemonData.stats.specialDefense} | SPE: ${pokemonData.stats.speed}<br>
                <strong>Total: ${totalStats}</strong>
            `;
        }

        function checkBattleReady() {
            const battleBtn = document.getElementById('battle-btn');
            if (selectedPokemon1 && selectedPokemon2) {
                battleBtn.disabled = false;
                battleBtn.style.background = 'linear-gradient(45deg, #ff4757, #ff3838)';
            }
        }

        async function startBattle() {
            if (!selectedPokemon1 || !selectedPokemon2) {
                showMessage('Please select both Pokemon first!', 'error', 'battle-controls');
                return;
            }

            console.log('Starting battle with:', selectedPokemon1.name, 'vs', selectedPokemon2.name);

            // Reset HP for new battle
            pokemon1HP = selectedPokemon1.stats.hp;
            pokemon2HP = selectedPokemon2.stats.hp;
            updateHealthBars();

            // Clear any previous battle results
            document.getElementById('battle-result').style.display = 'none';
            document.getElementById('log-content').innerHTML = '<p>Preparing for battle...</p>';

            showLoadingOverlay();

            try {
                // Simulate battle with guaranteed success
                console.log('Creating battle result...');
                const battleResult = createMockBattleResult();
                console.log('Battle result created:', battleResult);

                // Add delay for loading effect
                await new Promise(resolve => setTimeout(resolve, 1500)); // Reduced loading time

                console.log('Displaying battle results...');
                await displayBattleResults(battleResult);
                console.log('Battle results displayed successfully');

            } catch (error) {
                console.error('Battle error:', error);
                // Ensure we always show something
                document.getElementById('log-content').innerHTML = `
                    <div class="log-entry">
                        <strong>⚠️ Battle Error:</strong> ${error.message}<br>
                        <strong>📊 Stats Comparison:</strong><br>
                        ${selectedPokemon1.name}: ${Object.values(selectedPokemon1.stats).reduce((a, b) => a + b, 0)} total stats<br>
                        ${selectedPokemon2.name}: ${Object.values(selectedPokemon2.stats).reduce((a, b) => a + b, 0)} total stats
                    </div>
                `;
            } finally {
                hideLoadingOverlay();
            }
        }

        function createMockBattleResult() {
            const pokemon1Stats = Object.values(selectedPokemon1.stats).reduce((a, b) => a + b, 0);
            const pokemon2Stats = Object.values(selectedPokemon2.stats).reduce((a, b) => a + b, 0);

            const winner = pokemon1Stats > pokemon2Stats ? selectedPokemon1.name : selectedPokemon2.name;
            const loser = winner === selectedPokemon1.name ? selectedPokemon2.name : selectedPokemon1.name;

            return {
                winner: winner,
                loser: loser,
                battleLog: [
                    `${selectedPokemon1.name} enters the battlefield!`,
                    `${selectedPokemon2.name} prepares for battle!`,
                    `${selectedPokemon1.name} used Thunder Shock!`,
                    `${selectedPokemon2.name} used Quick Attack!`,
                    `${selectedPokemon1.name} used Thunderbolt!`,
                    `${winner} emerges victorious!`
                ],
                analysis: `${winner} won due to superior stats. ${winner} had ${winner === selectedPokemon1.name ? pokemon1Stats : pokemon2Stats} total base stats compared to ${loser}'s ${winner === selectedPokemon1.name ? pokemon2Stats : pokemon1Stats}.`,
                summary: `${winner} dominated this Pokemon battle through strategic superiority.`
            };
        }

        async function displayBattleResults(battleResult) {
            console.log('=== DISPLAYING BATTLE RESULTS ===');
            console.log('Battle result received:', battleResult);

            const logContent = document.getElementById('log-content');
            const battleResultDiv = document.getElementById('battle-result');

            if (!logContent) {
                console.error('Log content element not found!');
                return;
            }

            // Reset HP for battle start
            pokemon1HP = selectedPokemon1.stats.hp;
            pokemon2HP = selectedPokemon2.stats.hp;
            updateHealthBars();

            // Clear previous log and add initial message
            logContent.innerHTML = '<div class="log-entry"><strong>🎯 BATTLE BEGINS!</strong> The arena crackles with energy...</div>';

            try {
                // Display battle log with guaranteed execution
                console.log('Starting battle log display...');
                
                if (battleResult && battleResult.battleLog && Array.isArray(battleResult.battleLog)) {
                    console.log('Battle log found, displaying turns...');
                    
                    for (let i = 0; i < battleResult.battleLog.length; i++) {
                        console.log(`Displaying turn ${i + 1}: ${battleResult.battleLog[i]}`);
                        
                        // Add delay for animation (reduced for faster pace)
                        await new Promise(resolve => setTimeout(resolve, 300));

                        const logEntry = document.createElement('div');
                        logEntry.className = 'log-entry';
                        logEntry.innerHTML = `<strong>Turn ${i + 1}:</strong> ${battleResult.battleLog[i]}`;
                        logContent.appendChild(logEntry);

                        // Animate health bar reduction for attack turns
                        if (i >= 2 && i < battleResult.battleLog.length - 1) { // Skip intro and victory turns
                            await animateHealthReduction(i % 2 === 0 ? 2 : 1); // Alternate between Pokemon
                        }
                    }
                } else {
                    console.log('No battle log found, creating default log...');
                    // Fallback battle log
                    const defaultLog = [
                        `${selectedPokemon1.name} enters the battlefield with determination!`,
                        `${selectedPokemon2.name} responds with a fierce battle cry!`,
                        `${selectedPokemon1.name} makes the first strategic move!`,
                        `${selectedPokemon2.name} counters with incredible speed!`,
                        `The battle intensifies as both Pokemon give their all!`,
                        `${battleResult.winner} emerges as the ultimate victor!`
                    ];

                    for (let i = 0; i < defaultLog.length; i++) {
                        await new Promise(resolve => setTimeout(resolve, 300));
                        const logEntry = document.createElement('div');
                        logEntry.className = 'log-entry';
                        logEntry.innerHTML = `<strong>Turn ${i + 1}:</strong> ${defaultLog[i]}`;
                        logContent.appendChild(logEntry);

                        // Animate health bar reduction for attack turns
                        if (i >= 2 && i < defaultLog.length - 1) {
                            await animateHealthReduction(i % 2 === 0 ? 2 : 1);
                        }
                    }
                }

                // Add battle conclusion
                await new Promise(resolve => setTimeout(resolve, 400));
                const conclusionEntry = document.createElement('div');
                conclusionEntry.className = 'log-entry';
                conclusionEntry.style.cssText = 'background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1)); border-left-color: #ffd700; text-align: center; font-weight: bold;';
                conclusionEntry.innerHTML = '<strong>🏁 BATTLE CONCLUDED!</strong> The champion has been decided!';
                logContent.appendChild(conclusionEntry);

                console.log('Battle log display completed, showing results...');

                // Show battle result section
                setTimeout(() => {
                    console.log('Displaying final battle results...');
                    
                    if (battleResultDiv) {
                        battleResultDiv.style.display = 'block';
                        
                        const winnerElement = document.getElementById('winner-announcement');
                        const scenarioElement = document.getElementById('scenario-description');
                        const factorsElement = document.getElementById('key-factors');
                        
                        if (winnerElement) {
                            winnerElement.innerHTML = `
                                <h2>🏆 ${battleResult.winner.toUpperCase()} WINS! 🏆</h2>
                                <p style="margin-top: 10px; font-size: 1rem;">Victory achieved through superior strategy!</p>
                            `;
                        }

                        if (scenarioElement) {
                            scenarioElement.innerHTML = `
                                <h4>🎭 Battle Scenario:</h4>
                                <p>In this epic Pokemon battle between <strong>${selectedPokemon1.name}</strong> and <strong>${selectedPokemon2.name}</strong>,
                                the <strong>${battleResult.winner}</strong> emerged victorious through strategic superiority and powerful moves.
                                The battle showcased the unique strengths of ${selectedPokemon1.types.join('/')} vs ${selectedPokemon2.types.join('/')} type Pokemon.</p>
                            `;
                        }

                        if (factorsElement) {
                            factorsElement.innerHTML = `
                                <h4>💡 Key Factors:</h4>
                                <p><strong>Statistical Analysis:</strong> ${battleResult.analysis}</p>
                                <p><strong>Battle Summary:</strong> ${battleResult.summary}</p>
                            `;
                        }

                        // Scroll to results
                        battleResultDiv.scrollIntoView({ behavior: 'smooth' });
                        console.log('All battle results displayed successfully!');
                    }
                }, 500);

            } catch (error) {
                console.error('Error in displayBattleResults:', error);
                logContent.innerHTML = `
                    <div class="log-entry" style="background: rgba(231, 76, 60, 0.2); border-left-color: #e74c3c;">
                        <strong>⚠️ Display Error:</strong> ${error.message}<br>
                        <strong>📊 Quick Results:</strong><br>
                        Winner: <strong>${battleResult?.winner || selectedPokemon1.name}</strong><br>
                        Battle completed successfully despite display issues.
                    </div>
                `;
            }
        }

        function showLoadingOverlay() {
            console.log('Showing loading overlay...');
            const overlay = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-text');
            
            if (!overlay || !loadingText) {
                console.error('Loading elements not found!');
                return;
            }
            
            overlay.style.display = 'flex';

            const phases = [
                '🤖 Initializing Battle System...',
                '📊 Analyzing Pokemon Data...',
                '⚡ Calculating Moves...',
                '🎯 Running Battle Simulation...',
                '🏆 Determining Winner...'
            ];

            let phaseIndex = 0;
            const phaseInterval = setInterval(() => {
                if (phaseIndex < phases.length) {
                    loadingText.textContent = phases[phaseIndex];
                    console.log('Loading phase:', phases[phaseIndex]);
                    phaseIndex++;
                } else {
                    clearInterval(phaseInterval);
                    loadingText.textContent = '✨ Battle Results Ready!';
                }
            }, 250); // Reduced from 400ms to 250ms

            // Store interval for cleanup
            overlay.dataset.intervalId = phaseInterval;
        }

        function hideLoadingOverlay() {
            console.log('Hiding loading overlay...');
            const overlay = document.getElementById('loading-overlay');
            
            if (overlay) {
                // Clear any running intervals
                if (overlay.dataset.intervalId) {
                    clearInterval(parseInt(overlay.dataset.intervalId));
                }
                overlay.style.display = 'none';
            }
        }

        function showMessage(message, type, containerId) {
            const container = document.getElementById(containerId);
            const existingMessage = container.querySelector('.error-message, .success-message');
            if (existingMessage) existingMessage.remove();

            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            container.appendChild(messageDiv);

            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 4000);
        }

        function updateHealthBars() {
            const healthBar1 = document.getElementById('health-bar-1');
            const healthText1 = document.getElementById('health-text-1');
            const healthBar2 = document.getElementById('health-bar-2');
            const healthText2 = document.getElementById('health-text-2');

            if (healthBar1 && healthText1) {
                const hpPercent1 = (pokemon1HP / selectedPokemon1.stats.hp) * 100;
                healthBar1.style.width = `${Math.max(0, hpPercent1)}%`;
                healthText1.textContent = `HP: ${Math.max(0, Math.round(pokemon1HP))}/${selectedPokemon1.stats.hp}`;
            }

            if (healthBar2 && healthText2) {
                const hpPercent2 = (pokemon2HP / selectedPokemon2.stats.hp) * 100;
                healthBar2.style.width = `${Math.max(0, hpPercent2)}%`;
                healthText2.textContent = `HP: ${Math.max(0, Math.round(pokemon2HP))}/${selectedPokemon2.stats.hp}`;
            }
        }

        async function animateHealthReduction(targetPlayer) {
            const damage = Math.floor(Math.random() * 20) + 10; // Random damage between 10-30
            
            if (targetPlayer === 1) {
                pokemon1HP = Math.max(0, pokemon1HP - damage);
            } else {
                pokemon2HP = Math.max(0, pokemon2HP - damage);
            }
            
            updateHealthBars();
            
            // Add a brief pause for animation effect
            await new Promise(resolve => setTimeout(resolve, 200));
        }
        // Initialize
        console.log('Pokemon Battle Arena loaded!');
    </script>
</body>
</html>
